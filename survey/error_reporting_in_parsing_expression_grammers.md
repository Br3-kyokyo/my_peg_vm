# Error Reporting in Parsing Expression Grammars

## abstract

PEG はトップダウンパーサーを記述する。不幸なことに、従来のトップダウンパーサーで用いられているエラー報告技術を直接的に PEG パーサに適用することはできないため、なんらかの方法でシミュレートする必要がある。
PEG 形式が意味的動作を考慮しない一方で、実際の PEG の実装はそれらを加えており、我々はこれらの意味的動作を通してどのようにエラー報告を近似的にシミュレートするかを示す。
また、我々は良いエラーメッセージを導く補足的なエラー報告戦略「ラベル付き失敗」を提案する。このアプローチは、プログラミング言語の例外処理にヒントを得ており、PEG に異なる種類の失敗を定義し、各順序付き選択演算子ではどの種類の失敗をキャッチするかを指定します。

「ラベル付き失敗」は、より良いエラー報告のために文法に注釈を付ける方法を提供し、決定論的パーサ・コンビネータで使用されるエラー報告戦略のいくつかを表現し、PEG で予測的トップダウン・パーシングを表現する方法を提供します。

## introduction

パーサはエラーを含む入力を受け取ったとき、シンタックスエラーの存在を示す必要がある。

エラーの報告には様々な手段があり
一番簡単なのは、ただエラーが存在することを報告する手段である。

セクション 2... PEG におけるエラーハンドリングの問題を確認する。
セクション 3... バックトラックのあるトップダウンパーサのエラー報告に関する関連研究について論じる
セクション 4... ラベル付失敗の概念を定式化し、どのようにエラー報告に用いることができるのかを示す。
セクション 5... 失敗追跡近似に基づいてパーサーが生成したエラーメッセージと、ラベル付失敗に基づいてパーサが生成したエラ〜メッセージを比較する。
セクション 6... どのようにラベル付失敗がセクション 3 で述べられていたような技術を表現するのかを示す。
セクション 7... 結論を示す。

## PEG での構文エラーハンドリング

このセクションでは、シンタックスエラーの存在によって PEG がどのように悪く振舞うか例を用いて詳しく説明する。
その後、PEG エラー報告の実装するための、Ford による近似的手法を提示する。
Ford による近似的手法をそのまま使うよりもむしろ、等価でより簡潔な表示方法と意味を持つ Mederois による手法を例では用いている。
セクション 4 で提示されている PEG をサラベル付き失敗と共に表現するためのものに表示と意味を拡張している。

PEG $G$ はタプル(V, T, P, p_s)で表され、V は非終端記号の有限集合、T は終端記号の有限集合、P は非終端記号から parsing expressions への全写像、ps は初期 parsingexpression である。

一つの ParsingExpression は、入力が与えられた時、失敗するか入力の先頭を消費するかして、残りをリターンする。

以下のように抽象構文が与えられた場合、以下のような動作をする…

（parsing expression の各部分の説明）

図 1 は Tiny 言語の PEG である。Tiny は、Pascal に似た文法を持つシンプルな言語である。
我々は、LL(1)の文脈自由文法と等価なこの PEG を、バックトラックのないトップダウンパーサと PEG の間で、エラー報告にどのような違いが出るのかを示すために用いる。

PEG は普通、独立した字句解析器を必要とせず、文字レベルで構文を表現する。

例えば、エラーのあるプログラムを図 2 に示す。
PEG では普通、実際にエラーが起こった実際の位置を指し示すことができない。これは、エラーは入力における別の位置への PEG のバックトラックを引き起こすためである。

この例では、fail が観測されても、fail は親から祖父へ伝播していき、remaining suffix をエラー報告に用いていた場合、6 行目ではなく、3 行目にエラーを報告する。

この例では比較的簡単に正しいエラーを報告できるが、そうでない例もある。

Ford は、最も遠くの到達した位置を近似値とした。彼のパーサジェネレータ Pappy にも実装されていた。つまり、決定的パーサで実装されているエラー報告技術をシミュレートできる。

我々はあらゆる意味動作を与える PEG の実装に対するエラー報告を追加するために、最遠位置近似ほうを用いることができる。
